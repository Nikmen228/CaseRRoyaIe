<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CS:GO Case Opener</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–µ–π -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç Telegram Web App -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ç–µ–º—ã Telegram */
        :root {
            --bg-color: var(--tg-theme-bg-color, #181c21);
            --text-color: var(--tg-theme-text-color, #ffffff);
            --hint-color: var(--tg-theme-hint-color, #aaaaaa);
            --button-color: var(--tg-theme-button-color, #5288c1);
            --button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg-color: var(--tg-theme-secondary-bg-color, #2a2d32);
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .case-card {
            background-color: var(--secondary-bg-color);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
        }
        .case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .action-button {
            background-color: var(--button-color);
            color: var(--button-text-color);
            transition: background-color 0.2s, transform 0.1s;
        }
        .action-button:active {
            transform: scale(0.95);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏ —Ä—É–ª–µ—Ç–∫–∏ */
        #roulette-modal {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        #roulette-container {
            width: 100%;
            overflow: hidden;
            border-top: 2px solid var(--button-color);
            border-bottom: 2px solid var(--button-color);
        }
        #roulette-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(rgba(255,255,255,0), var(--button-text-color), rgba(255,255,255,0));
            transform: translateX(-50%);
            z-index: 10;
        }
        #roulette-spinner {
            display: flex;
            transition: transform 5s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .roulette-item {
            flex-shrink: 0;
            width: 120px;
            height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
            background-size: cover;
            text-align: center;
        }
        .roulette-item-name {
            font-size: 0.8rem;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        /* –¶–≤–µ—Ç–∞ —Ä–µ–¥–∫–æ—Å—Ç–∏ –¥–ª—è —Ä—É–ª–µ—Ç–∫–∏ */
        .rarity-Common { background-color: #3d424b; }
        .rarity-Uncommon { background-color: #4a6a8b; }
        .rarity-Rare { background-color: #5d4a8b; }
        .rarity-Mythical { background-color: #8b4a78; }
        .rarity-Legendary { background-color: #a44e4e; }
        .rarity-Ancient { background-color: #daa520; }
    </style>
</head>
<body class="antialiased p-4">

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="main-content" class="w-full max-w-lg mx-auto">
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold">Case Opener</h1>
            <p id="user-greeting" class="text-lg" style="color: var(--hint-color);">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>

        <div class="space-y-5">
            <!-- –ì–∞–º–º–∞-–∫–µ–π—Å -->
            <div class="case-card p-5 rounded-xl shadow-lg" onclick="prepareAndOpenCase('gamma')">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-semibold">–ì–∞–º–º–∞-–∫–µ–π—Å</h2>
                        <p class="text-sm" style="color: var(--hint-color);">–®–∞–Ω—Å –Ω–∞ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –Ω–æ–∂–∏</p>
                    </div>
                    <img src="https://placehold.co/80x80/2a2d32/ffffff?text=üì¶" class="rounded-lg" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–µ–π—Å–∞">
                </div>
            </div>

            <!-- –•—Ä–æ–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–µ–π—Å 3 -->
            <div class="case-card p-5 rounded-xl shadow-lg" onclick="prepareAndOpenCase('chroma')">
                 <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-semibold">–•—Ä–æ–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–µ–π—Å 3</h2>
                        <p class="text-sm" style="color: var(--hint-color);">–°–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–Ω–Ω—ã–µ —Å–∫–∏–Ω—ã</p>
                    </div>
                    <img src="https://placehold.co/80x80/2a2d32/ffffff?text=üì¶" class="rounded-lg" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–µ–π—Å–∞">
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ä—É–ª–µ—Ç–∫–æ–π -->
    <div id="roulette-modal" class="fixed inset-0 z-50 flex-col items-center justify-center p-4 hidden">
        <div class="w-full max-w-lg mx-auto">
             <h2 id="modal-title" class="text-2xl font-bold text-center mb-4">–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞...</h2>
            <div id="roulette-container" class="relative">
                <div id="roulette-spinner"></div>
                <div id="roulette-line"></div>
            </div>
        </div>
        <!-- –û–±–ª–∞—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
        <div id="result-display" class="text-center mt-6 hidden">
            <h3 class="text-xl font-bold">–í–∞–º –≤—ã–ø–∞–ª–æ:</h3>
            <p id="result-item-name" class="text-3xl font-bold"></p>
            <p id="result-item-price" class="text-lg" style="color: var(--hint-color);"></p>
            <button onclick="closeModal()" class="action-button font-bold py-2 px-6 rounded-lg mt-4">–û—Ç–ª–∏—á–Ω–æ!</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand(); // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        // --- –î–ê–ù–ù–´–ï –ò–ì–†–´ (–ö–õ–ò–ï–ù–¢–°–ö–ê–Ø –°–¢–û–†–û–ù–ê) ---
        const CASES_DATA = {
            gamma: { name: '–ì–∞–º–º–∞-–∫–µ–π—Å', items: [
                {name: 'Five-SeveN | –ö–∞–ø–∏–ª–ª—è—Ä—ã', rarity: 'Rare', price: 7.50}, {name: 'MAC-10 | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ', rarity: 'Uncommon', price: 1.20}, {name: 'M4A4 | –¢—É—Å–∫–ª—ã–π –±–ª–µ—Å–∫', rarity: 'Mythical', price: 15.00}, {name: 'UMP-45 | –ú–µ—Ö–∞–Ω–æ-–ø—É—à–∫–∞', rarity: 'Uncommon', price: 1.15}, {name: 'Glock-18 | –ü—É—Å—Ç–æ—à—å', rarity: 'Legendary', price: 80.00}, {name: 'SCAR-20 | –ö—Ä–æ–≤–∞–≤—ã–π —Å–ø–æ—Ä—Ç', rarity: 'Mythical', price: 18.50}, {name: 'AWP | –°–∫–æ—Ä–æ—Å—Ç–Ω–æ–π –∑–≤–µ—Ä—å', rarity: 'Legendary', price: 120.00}, {name: 'M4A1-S | –ú–µ—Ö–∞–Ω–æ-–ø—É—à–∫–∞', rarity: 'Legendary', price: 95.00}, {name: '–ì–∞–º–º–∞-–Ω–æ–∂–∏', rarity: 'Ancient', price: 450.00}
            ]},
            chroma: { name: '–•—Ä–æ–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–µ–π—Å 3', items: [
                {name: 'P250 | –í–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å', rarity: 'Rare', price: 5.00}, {name: 'UMP-45 | –ì—Ä–∞–Ω-–ø—Ä–∏', rarity: 'Uncommon', price: 0.90}, {name: 'CZ75-Auto | –ü–æ–ª–∏–º–µ—Ä', rarity: 'Rare', price: 4.50}, {name: 'Galil AR | –©–µ–ª–∫—É–Ω—á–∏–∫', rarity: 'Mythical', price: 25.00}, {name: 'M4A1-S | –û–≥–æ–Ω—å —à–∞–Ω—Ç–∏–∫–æ', rarity: 'Legendary', price: 150.00}, {name: 'PP-Bizon | –°—É–¥ –ê–Ω—É–±–∏—Å–∞', rarity: 'Mythical', price: 22.00}, {name: 'SSG 08 | –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π —Ñ–∞–Ω–∞—Ç–∏–∫', rarity: 'Rare', price: 6.00}, {name: 'Tec-9 | –¢–æ–ø–ª–∏–≤–Ω—ã–π –∏–Ω–∂–µ–∫—Ç–æ—Ä', rarity: 'Mythical', price: 30.00}, {name: '–ù–æ–∂–∏ ‚òÖ', rarity: 'Ancient', price: 500.00}
            ]}
        };
        
        // --- –≠–õ–ï–ú–ï–ù–¢–´ DOM ---
        const userGreeting = document.getElementById('user-greeting');
        const modal = document.getElementById('roulette-modal');
        const modalTitle = document.getElementById('modal-title');
        const spinner = document.getElementById('roulette-spinner');
        const resultDisplay = document.getElementById('result-display');
        const resultItemName = document.getElementById('result-item-name');
        const resultItemPrice = document.getElementById('result-item-price');

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        if (tg.initDataUnsafe.user) {
            userGreeting.textContent = `–ü—Ä–∏–≤–µ—Ç, ${tg.initDataUnsafe.user.first_name}!`;
        } else {
            userGreeting.textContent = '–ü—Ä–∏–≤–µ—Ç, –∏–≥—Ä–æ–∫!';
        }

        function prepareAndOpenCase(caseId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–µ–π—Å
            // –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç –±–æ—Ç–∞
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É, —á—Ç–æ –º—ã —Ö–æ—Ç–∏–º –æ—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å
            // –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ç–æ, —Å–ø–∏—Å–∞—Ç—å –∫–µ–π—Å –∏ –ø—Ä–∏—Å–ª–∞—Ç—å –æ—Ç–≤–µ—Ç.
            // –ü–æ–∫–∞ —á—Ç–æ –º—ã –∏–º–∏—Ç–∏—Ä—É–µ–º —ç—Ç–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.
            tg.sendData(JSON.stringify({ action: "attempt_open", caseId: caseId }));
            
            const caseData = CASES_DATA[caseId];
            modalTitle.textContent = `–û—Ç–∫—Ä—ã—Ç–∏–µ: ${caseData.name}`;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä—É–ª–µ—Ç–∫—É
            let rouletteItems = [];
            for (let i = 0; i < 50; i++) {
                rouletteItems.push(caseData.items[Math.floor(Math.random() * caseData.items.length)]);
            }

            // –í—ã–±–∏—Ä–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç (–ª–æ–≥–∏–∫–∞ –∏–∑ –±–æ—Ç–∞)
            const chances = caseData.items.map(item => ({...item, weight: getWeightByRarity(item.rarity)}));
            const totalWeight = chances.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * totalWeight;
            let winningItem = chances[chances.length - 1];
            for (const item of chances) {
                if (random < item.weight) {
                    winningItem = item;
                    break;
                }
                random -= item.weight;
            }
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤ —Ä—É–ª–µ—Ç–∫—É –Ω–∞ 45-–µ –º–µ—Å—Ç–æ
            rouletteItems[45] = winningItem;

            spinner.innerHTML = rouletteItems.map(item => `
                <div class="roulette-item rarity-${item.rarity}">
                    <div class="roulette-item-name text-white">${item.name}</div>
                </div>
            `).join('');

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä—É–ª–µ—Ç–∫—É
            setTimeout(() => runRoulette(winningItem), 100);
        }

        function getWeightByRarity(rarity) {
            // –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –≤–µ—Å–∞, –æ–±—Ä–∞—Ç–Ω—ã–µ —à–∞–Ω—Å–∞–º
            switch(rarity) {
                case 'Ancient': return 1;
                case 'Legendary': return 5;
                case 'Mythical': return 10;
                case 'Rare': return 50;
                case 'Uncommon': return 250;
                default: return 1000;
            }
        }

        function runRoulette(winningItem) {
            spinner.style.transition = 'none';
            spinner.style.transform = 'translateX(0)';
            
            setTimeout(() => {
                spinner.style.transition = 'transform 5s cubic-bezier(0.1, 0.7, 0.3, 1)';
                // 45 - –ø–æ–∑–∏—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞, 120 - —à–∏—Ä–∏–Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
                // –°–º–µ—â–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª–æ–≤–∏–Ω—É, —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å
                const targetPosition = (45 * 120) - (modal.clientWidth / 2) + 60;
                const randomOffset = (Math.random() - 0.5) * 100; // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏
                spinner.style.transform = `translateX(-${targetPosition + randomOffset}px)`;
            }, 100);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => showResult(winningItem), 5500);
        }

        function showResult(item) {
            resultItemName.textContent = item.name;
            resultItemPrice.textContent = `–°—Ç–æ–∏–º–æ—Å—Ç—å: $${item.price.toFixed(2)}`;
            resultItemName.className = `text-3xl font-bold rarity-text-${item.rarity}`;
            resultDisplay.classList.remove('hidden');
            tg.HapticFeedback.notificationOccurred('success');
        }

        function closeModal() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            resultDisplay.classList.add('hidden');
        }

    </script>
</body>
</html>
